{
  "hash": "e9ec62888ae5ba55ff80b563f9489dcc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity39\"\nformat: \n  live-html:\n    theme:\n      light: [lux, theme-light.scss]\n      dark: [superhero, theme-dark.scss] \nengine: knitr\ntoc: true\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n## **Extending ETS Models with Predictors**  \n\n**Data Prep**  \n\n- Use historical energy demand + temperature  \n- Ensure alignment in timestamps (`drop_na()`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenergy_series <- vic_elec %>%\n  filter_index(~ \"2014-12-31\") %>%\n  dplyr::select(Time, Demand, Temperature) %>%\n  drop_na()\n```\n:::\n\n\n**Step 1 - Baseline ETS Model**  \n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. ETS for Demand (non-seasonal)\ndemand_ets <- energy_series %>% model(ETS(Demand))\ndemand_ets_fc <- demand_ets %>% \n  forecast(h = \"1 week\") %>% \n  as_tibble() %>% \n  rename(mean = .mean) %>% \n  mutate(Model = \"ETS\")\n```\n:::\n\n\n$$\\text{Demand}_t = \\text{Level}_{t-1} + \\text{Error}_t$$  \n\nThe first model uses ETS (Error-Trend-Seasonal) for demand alone. This is limited because:\n\n- Ignores temperature (known predictor)\n- Assumes patterns are purely endogenous\n\n**Step 2 - ARIMAX with Temperature**  \n\n::: {.cell}\n\n```{.r .cell-code}\n# 2. ARIMAX with temperature forecasts\n# First forecast temperature\ntemp_ets <- energy_series %>% model(ETS(Temperature))\ntemp_fc <- temp_ets %>% \n  forecast(h = \"1 week\") %>% \n  as_tibble() %>% \n  dplyr::select(Time, Temperature = .mean)\n\ndemand_dr <- energy_series %>% model(ARIMA(Demand ~ Temperature))\n\ndemand_dr_fc <- demand_dr %>% \n  forecast(new_data = temp_fc %>% as_tsibble(index = Time)) %>% \n  as_tibble() %>% \n  rename(mean = .mean) %>% \n  mutate(Model = \"ARIMAX\")\n```\n:::\n\n\n$$\\text{Demand}_t = \\phi_1 \\text{Demand}_{t-1} + \\beta \\text{Temperature}_t + \\epsilon_t$$  \n\nImprovement: Adds temperature as exogenous predictor.  \n*But requires temperature forecasts* - introduces error propagation if temperature predictions are poor.\n\n---\n\n### **Part 2: Why VAR Models Shine for Short-Term**  \n\n**Vector Autoregression (VAR)**  \n\n$$\\begin{cases}\n\\text{Demand}_t = \\alpha_1 + \\sum_{i=1}^p \\phi_{1i}\\text{Demand}_{t-i} + \\sum_{i=1}^p \\psi_{1i}\\text{Temp}_{t-i} \\\\\n\\text{Temp}_t = \\alpha_2 + \\sum_{i=1}^p \\phi_{2i}\\text{Demand}_{t-i} + \\sum_{i=1}^p \\psi_{2i}\\text{Temp}_{t-i}\n\\end{cases}$$\n\n**Key Advantages**  \n\n1. Handles *bidirectional relationships* (temperature â†” demand)\n2. Captures *lagged cross-effects*  \n3. Better for short-term forecasts where system inertia matters\n\n---\n\n**3. Critical Implementation Details**  \n\n- *Differencing*: Makes series stationary for VAR (`difference()`)\n- *Lag choice*: 48 lags = 24hr periodicity (half-hourly data)\n- *Forecast alignment*:  \n\n$$\\text{VarForecast}_t = \\text{LastObs} + \\sum \\text{DifferencedForecasts}_t$$\n\n(Reverse the differencing through cumulative sums)\n\n**4. Comparison**  \n\n- ETS: Good baseline but misses covariates  \n- ARIMAX: Better with good temp forecasts  \n- VAR: Best for short-term co-movements, no external forecast needed\n\n::: {.cell}\n\n```{.r .cell-code}\n# 3. VAR with tsDyn implementation\nvar_data <- energy_series %>% as_tibble() %>% \n  select(Demand, Temperature) %>%\n  mutate(across(everything(), difference)) %>% \n  tidyr::drop_na()\n\nvar_model <- tsDyn::lineVar(var_data, lag = 48)\nvar_fc <- predict(var_model, n.ahead = 336)\n\n# Align VAR forecasts with original scale\nlast_obs <- tail(energy_series, 1)\nvar_fc_demand <- tibble(\n  Time = demand_ets_fc$Time,\n  mean = last_obs$Demand + cumsum(var_fc[,1]),\n  Model = \"VAR\"\n)\n\n# Combine forecasts \ncombined_fc <- bind_rows(\n  demand_ets_fc %>% select(Time, Model, mean),\n  demand_dr_fc %>% select(Time, Model, mean),\n  var_fc_demand\n)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with accurate comparisons\nggplot() +\n  geom_line(data = energy_series %>% tail(2016),  # Last 2 weeks\n           aes(x = Time, y = Demand), color = \"gray40\") +\n  geom_line(data = combined_fc, \n           aes(x = Time, y = mean, color = Model), linewidth = 0.8) +\n  labs(title = \"Electricity Demand Forecasts: Three Methodologies\",\n       subtitle = \"Using actual temperature forecasts for ARIMAX\\nVAR with 48-lag (24h) differenced model\",\n       y = \"Demand (MW)\") +\n  theme_minimal() +\n  scale_color_viridis_d(option = \"H\")\n```\n\n::: {.cell-output-display}\n![](activity39_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "activity39_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
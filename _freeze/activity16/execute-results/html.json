{
  "hash": "6e0f214cfe3f97ac7f51028789ea27b7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity16\"\nformat: live-html\nengine: knitr\ntoc: true\nwebr:\n  packages:\n    - dplyr\n    - ggplot2\n    - fpp3\n    - patchwork\n    - tsibbledata\n    - urca\n    - astsa\n    - COVID19\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n## COVID Data Analysis and Granger causality test\n\n### Objective\n\nInvestigate whether changes in COVID-19 vaccination numbers help predict changes in confirmed cases using a Granger causality test.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retrieve COVID-19 data for the United States and prepare a tsibble\ncovid_data <- covid19(verbose = FALSE) %>% \n  filter(administrative_area_level_1 == \"United States\") %>% \n  mutate(date = ymd(date)) %>% \n  as_tsibble(index = date) %>% \n  select(date, confirmed, vaccines) %>% \n  mutate(vaccines = as.integer(vaccines)) %>% \n  drop_na()\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute daily changes in confirmed cases and vaccinations\ncovid_data <- covid_data %>% \n  mutate(dConfirmed = difference(confirmed),\n         dVacc = difference(vaccines)) %>% \n  drop_na()\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot daily changes in confirmed cases and vaccinations\ncovid_data %>% \n  autoplot(vars(dConfirmed, dVacc)) +\n  labs(title = \"Daily Changes: Confirmed Cases & Vaccinations\", x = \"Date\")\n```\n\n::: {.cell-output-display}\n![](activity16_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Granger Causality Test: Theory & Implementation\n\nThe Granger causality test checks whether past values of one variable (here, dVacc) provide statistically significant information for predicting another variable (dConfirmed).\n\n**Implications and Uses:**\n\n- A significant result (p-value < 0.05) suggests that changes in vaccinations Granger-cause changes in confirmed cases.\n- This does not imply true causality, but indicates that past vaccination data improves forecast accuracy for confirmed cases.\n- Such insights can help inform public health policies by highlighting the predictive value of vaccination trends.\n\n**P-value Interpretation:**\n\n- p < 0.05: Reject the null hypothesis. Past vaccination changes significantly improve prediction of confirmed cases.\n- p â‰¥ 0.05: Fail to reject the null hypothesis. Vaccination changes do not add significant predictive power.\n\n\n### VAR Modeling and IRF Computation\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test if changes in vaccinations (dVacc) Granger-cause changes in confirmed cases (dConfirmed) using a lag of 1.\nmodel_full <- lm(dConfirmed ~ lag(dVacc, 1), data = covid_data)\nmodel_restricted <- lm(dConfirmed ~ 1, data = covid_data)\nF_stat <- ((deviance(model_restricted) - deviance(model_full)) / 1) / \n          (deviance(model_full) / (nrow(covid_data) - 2 - 1))\ndf1 <- 1\ndf2 <- nrow(covid_data) - 2 - 1\np_value <- pf(F_stat, df1, df2, lower.tail = FALSE)\np_value\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.260462\n```\n\n\n:::\n:::\n\n\n## Lab Activity: Exploring Granger Causality with Different Lags\n\n**Task:** Using the covid_data, perform Granger causality tests with lag orders 1, 2, 3, 5, and 10.\n\nFor each lag, compute the p-value to assess whether lagged vaccination changes improve the prediction\nof confirmed cases. Answer the following:\n\n1. How do the p-values change with different lag orders?\n2. Which lag order appears most appropriate for capturing the predictive relationship?\n\nWrite a brief discussion on how these findings might inform public health policy.\n\n::: {.cell}\n```{webr}\n# Retrieve COVID-19 data for the United States and prepare a tsibble\ncovid_data <- covid19(verbose = FALSE) %>% \n  filter(administrative_area_level_1 == \"United States\") %>% \n  mutate(date = ymd(date)) %>% \n  as_tsibble(index = date) %>% \n  select(date, confirmed, vaccines) %>% \n  mutate(vaccines = as.numeric(vaccines)) %>% \n  mutate(dConfirmed = difference(confirmed),\n         dVacc = difference(vaccines)) %>% \n  drop_na()\n\n# Test Granger causality using multiple lag orders and collect the results.\nlag_orders <- c(1, 2, 3, 5, 10)\nresults <- data.frame(Lag = integer(), P_Value = numeric())\n\nfor (lag_order in lag_orders) {\n  model_full <- lm(dConfirmed ~ lag(dVacc, lag_order), data = covid_data)\n  model_restricted <- lm(dConfirmed ~ 1, data = covid_data)\n  F_stat <- ((deviance(model_restricted) - deviance(model_full)) / 1) / \n            (deviance(model_full) / (nrow(covid_data) - lag_order - 1))\n  df1 <- 1\n  df2 <- nrow(covid_data) - lag_order - 1\n  p_value <- pf(F_stat, df1, df2, lower.tail = FALSE)\n  results <- rbind(results, data.frame(Lag = lag_order, P_Value = p_value))\n}\n\nprint(results)\n```\n:::\n\n",
    "supporting": [
      "activity16_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
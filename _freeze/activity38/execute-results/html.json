{
  "hash": "c80ded8584368168269ad3f875727276",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity38\"\nformat: \n  live-html:\n    theme:\n      light: [lux, theme-light.scss]\n      dark: [superhero, theme-dark.scss] \nengine: knitr\ntoc: true\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n## Inflation Dynamics\n\n::: {.cell}\n\n```{.r .cell-code}\ngetSymbols(\"CPIAUCSL\", src = \"FRED\", auto.assign = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"CPIAUCSL\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncpi_data <- tibble(date = index(CPIAUCSL), CPI = as.numeric(CPIAUCSL[,1])) %>%\n  arrange(date) %>%\n  mutate(inflation = 100 * (CPI / lag(CPI) - 1)) %>%\n  mutate(Quarter = yearquarter(date)) %>% \n  as_tsibble(index = date) %>% \n  index_by(Quarter) %>% \n    summarize(CPI = mean(CPI),\n              inflation = mean(inflation))\n\n# Get US unemployment (monthly)\ngetSymbols(\"UNRATE\", src = \"FRED\", auto.assign = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"UNRATE\"\n```\n\n\n:::\n\n```{.r .cell-code}\nus_unemp <- data.frame(date = index(UNRATE), \n                      Unemployment = as.numeric(UNRATE$UNRATE)) %>%\n  as_tsibble(index = date) %>% \n  mutate(Quarter = yearquarter(date)) %>% \n  index_by(Quarter) %>% \n    summarize(Unemployment = mean(Unemployment))\n\n\n# Get US GDP (quarterly) and merge\ngetSymbols(\"GDP\", src = \"FRED\", auto.assign = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GDP\"\n```\n\n\n:::\n\n```{.r .cell-code}\nus_gdp <- data.frame(date = index(GDP), GDP = as.numeric(GDP$GDP)) %>%\n  as_tsibble(index = date) %>% \n  mutate(Quarter = yearquarter(date))\n\ncombined_data <- us_gdp %>% \n  inner_join(us_unemp, by = \"Quarter\") %>% \n  inner_join(cpi_data, by = \"Quarter\") %>% \n  mutate(GDP_growth = 100 * (GDP / lag(GDP) - 1)) %>% \n  dplyr::select(Quarter, date, GDP, GDP_growth, Unemployment, CPI, inflation) %>% \n  drop_na()\n\n# View the combined data\nhead(combined_data) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n\n\n|Quarter |date       |     GDP| GDP_growth| Unemployment|      CPI|  inflation|\n|:-------|:----------|-------:|----------:|------------:|--------:|----------:|\n|1948 Q2 |1948-04-01 | 272.567|  2.5682805|     3.666667| 23.99333|  0.9141472|\n|1948 Q3 |1948-07-01 | 279.196|  2.4320626|     3.766667| 24.39667|  0.2905382|\n|1948 Q4 |1948-10-01 | 280.366|  0.4190604|     3.833333| 24.17333| -0.4258609|\n|1949 Q1 |1949-01-01 | 275.034| -1.9017998|     4.666667| 23.94333| -0.1942711|\n|1949 Q2 |1949-04-01 | 271.351| -1.3391072|     5.866667| 23.91667|  0.0139470|\n|1949 Q3 |1949-07-01 | 272.889|  0.5667936|     6.700000| 23.71667| -0.2362540|\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Chow test for structural breaks\nbreak_test <- Fstats(inflation ~ GDP_growth + Unemployment + CPI, data = combined_data)\nplot(break_test)  # Identify potential breakpoints\n```\n\n::: {.cell-output-display}\n![](activity38_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Estimate breakpoint date(s)\nbp <- breakpoints(inflation ~  GDP_growth + Unemployment + CPI, data = combined_data)\n\ncombined_data$Quarter[bp$breakpoints] \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<yearquarter[1]>\n[1] \"1981 Q3\"\n# Year starts on: January\n```\n\n\n:::\n\n```{.r .cell-code}\n# Fit segmented regression\nsegmented_model <- lm(inflation ~ GDP_growth + Unemployment + CPI, \n                      data = combined_data, \n                      subset = breakpoints(bp)$breakpoints)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get breakpoint indices \nbp_indices <- bp$breakpoints \n\n# Split data into segments\nsegments <- split(combined_data, \n                 findInterval(1:nrow(combined_data), \n                              vec = c(0, bp_indices)))\n\n# Fit models to each segment\nsegment_models <- lapply(segments, function(df) {\n  lm(inflation ~ GDP_growth + Unemployment + CPI, data = df)\n})\n```\n:::\n\n\n\n#### **1. Fit ETS to Segments (Tidyverts)**\n\n::: {.cell}\n\n```{.r .cell-code}\nets_models <- segments %>% \n  map(~ {\n      .x %>% \n        as_tsibble(index = Quarter) %>% \n        model(ETS(inflation))\n    }\n  )\n\nets_models %>% .[[1]] %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: inflation \nModel: ETS(A,N,N) \n  Smoothing parameters:\n    alpha = 0.6051359 \n\n  Initial states:\n      l[0]\n 0.5740484\n\n  sigma^2:  0.0475\n\n     AIC     AICc      BIC \n249.2322 249.4183 257.9033 \n```\n\n\n:::\n\n```{.r .cell-code}\nets_models %>% .[[2]] %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: inflation \nModel: ETS(A,N,N) \n  Smoothing parameters:\n    alpha = 0.1015893 \n\n  Initial states:\n      l[0]\n 0.3795544\n\n  sigma^2:  0.0443\n\n     AIC     AICc      BIC \n359.3042 359.4453 368.7813 \n```\n\n\n:::\n:::\n\n#### **1. Fit ARIMA to Segments**\n\n::: {.cell}\n\n```{.r .cell-code}\narima_models <- segments %>% \n  map(~ {\n      .x %>% \n        as_tsibble(index = Quarter) %>% \n        model(ARIMA(inflation))\n    }\n  )\n\narima_models %>% .[[1]] %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: inflation \nModel: ARIMA(2,1,0)(0,0,2)[4] \n\nCoefficients:\n          ar1      ar2     sma1     sma2\n      -0.4293  -0.2336  -0.2345  -0.4806\ns.e.   0.0908   0.0938   0.0895   0.0929\n\nsigma^2 estimated as 0.0369:  log likelihood=30.87\nAIC=-51.73   AICc=-51.26   BIC=-37.32\n```\n\n\n:::\n\n```{.r .cell-code}\narima_models %>% .[[2]] %>% report()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: inflation \nModel: ARIMA(1,0,1)(1,0,0)[4] w/ mean \n\nCoefficients:\n         ar1      ma1     sar1  constant\n      0.8653  -0.7065  -0.0715    0.0356\ns.e.  0.0957   0.1310   0.0830    0.0045\n\nsigma^2 estimated as 0.04345:  log likelihood=27.9\nAIC=-45.79   AICc=-45.44   BIC=-30\n```\n\n\n:::\n:::\n\n#### **2. Fit VAR to Segments (vars)**\n\n::: {.cell}\n\n```{.r .cell-code}\nvar_models <- segments %>%\n  map(~ {\n      var_data <- .x %>%  as_tibble() %>% \n        dplyr::select(inflation, GDP_growth, Unemployment) %>% \n        as.data.frame()\n      \n      lag_order <- VARselect(var_data, type = \"const\")$selection[\"AIC(n)\"]\n      \n      # Fit VAR model\n      VAR(var_data, p = lag_order)\n  })\n\nvar_models %>% .[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nVAR Estimation Results:\n======================= \n\nEstimated coefficients for equation inflation: \n============================================== \nCall:\ninflation = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + inflation.l3 + GDP_growth.l3 + Unemployment.l3 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n    0.485356425     0.013048892    -0.091894301     0.181597228    -0.027973849 \nUnemployment.l2    inflation.l3   GDP_growth.l3 Unemployment.l3           const \n    0.027017410     0.248180381    -0.002642696     0.076192123     0.016954999 \n\n\nEstimated coefficients for equation GDP_growth: \n=============================================== \nCall:\nGDP_growth = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + inflation.l3 + GDP_growth.l3 + Unemployment.l3 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n      1.4631099       0.1369256      -0.6840633      -0.4099621       0.1714791 \nUnemployment.l2    inflation.l3   GDP_growth.l3 Unemployment.l3           const \n      1.3733278      -0.2312273      -0.1665613      -0.4515867       0.1062290 \n\n\nEstimated coefficients for equation Unemployment: \n================================================= \nCall:\nUnemployment = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + inflation.l3 + GDP_growth.l3 + Unemployment.l3 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n     0.09656011     -0.08540808      1.41859906      0.16250345     -0.09960353 \nUnemployment.l2    inflation.l3   GDP_growth.l3 Unemployment.l3           const \n    -0.81363353      0.36337053     -0.00838331      0.32764696      0.53593571 \n```\n\n\n:::\n\n```{.r .cell-code}\nvar_models %>% .[[2]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nVAR Estimation Results:\n======================= \n\nEstimated coefficients for equation inflation: \n============================================== \nCall:\ninflation = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n    0.085879261     0.055166163     0.063392818     0.006914984     0.030556416 \nUnemployment.l2           const \n   -0.060082569     0.084377774 \n\n\nEstimated coefficients for equation GDP_growth: \n=============================================== \nCall:\nGDP_growth = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n     0.01538228      0.82934430      1.41802522     -0.56668840      0.28639146 \nUnemployment.l2           const \n    -1.29275957     -0.74656121 \n\n\nEstimated coefficients for equation Unemployment: \n================================================= \nCall:\nUnemployment = inflation.l1 + GDP_growth.l1 + Unemployment.l1 + inflation.l2 + GDP_growth.l2 + Unemployment.l2 + const \n\n   inflation.l1   GDP_growth.l1 Unemployment.l1    inflation.l2   GDP_growth.l2 \n     0.10447307     -0.54363136      0.20051151      0.61151520     -0.09102577 \nUnemployment.l2           const \n     0.71546509      1.11828373 \n```\n\n\n:::\n:::\n\n\n#### **3. Model Analysis**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare ETS components across regimes\nets_models %>% \n  compact() %>%  # Remove NULL entries\n  map(~ components(.x) %>% autoplot() + labs(title = \"ETS Decomposition\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`1`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](activity38_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$`2`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](activity38_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\narima_models %>%\n  compact() %>%\n  imap(~ {\n    gg_tsresiduals(.x) +  # Special fable residuals plot\n      labs(title = paste(\"Residual Diagnostics - Regime\", .y))\n  })\n```\n\n::: {.cell-output-display}\n![](activity38_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](activity38_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`1`\n\n$`2`\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare VAR relationships\nvar_models %>% \n  compact() %>% \n  map(~ {\n    tibble(\n      Causality_GDP = causality(.x, cause = \"GDP_growth\")$Granger$p.value,\n      Causality_Unemp = causality(.x, cause = \"Unemployment\")$Granger$p.value\n    )\n  })\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`1`\n# A tibble: 1 × 2\n  Causality_GDP[,1] Causality_Unemp[,1]\n              <dbl>               <dbl>\n1            0.0169             0.00484\n\n$`2`\n# A tibble: 1 × 2\n  Causality_GDP[,1] Causality_Unemp[,1]\n              <dbl>               <dbl>\n1        0.00000520            6.31e-14\n```\n\n\n:::\n:::\n\n\n**Q: What do these models tell us about different economic regimes before/after the breakpoint?**  \n\n<!--\n\nA: The analysis reveals three key regime shifts:\n\n1. **Volatility Changes (ETS):**  \n\n- Pre-break: Higher $\\alpha=0.605$ (rapid adjustment to new data)  \n- Post-break: Lower $\\alpha=0.102$ (smoother evolution)  \n\n*Implication:* Inflation became more stable post-breakpoint  \n\n2. **Structural Shifts (ARIMA):**  \n\n- Pre-break: Requires differencing ($d=1$) with seasonal MA components  \n- Post-break: Stationary ($d=0$) with seasonal AR component  \n\n*Implication:* Fundamental change in inflation dynamics requiring different stabilization approaches  \n\n3. **Causal Relationships (VAR):**  \n\n- Pre-break: Moderate Granger-causality (GDP→inflation p=0.017; Unemp→inflation p=0.005)  \n- Post-break: Stronger causal links (GDP→inflation p=5.2e-6; Unemp→inflation p=6.3e-14)  \n*Implication:* Post-break economic indicators became more interconnected/predictive of inflation\n\n**Q: How should instructors explain these results to students?**  \n\nFocus on regime-dependent policymaking:  \n\n1. Pre-break required reactive policies (high volatility)  \n2. Post-break allows proactive strategies (stable but interconnected system)  \n3. Highlight changed seasonal patterns (ARIMA orders) and strengthened indicator relationships (VAR p-values) as evidence of structural break impacts\n\n-->\n\n\n\n",
    "supporting": [
      "activity38_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
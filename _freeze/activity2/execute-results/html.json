{
  "hash": "5a386bb3efcd80de1d5c6623412db040",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity2\"\nformat: live-html\nengine: knitr\ntoc: true\nwebr:\n  packages:\n    - dplyr\n    - ggplot2\n    - fpp3\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n## Correlation, Covariance, and Partial Correlation in Time Series\n\nIn time series analysis, understanding relationships between different variables is crucial. Three fundamental statistical concepts that help capture these relationships are **covariance**, **correlation**, and **partial correlation**.\n\n### Covariance\n\nCovariance measures how two variables move together. For two time series $X_t$ and $Y_t$, the sample covariance over $n$ periods is given by:\n\n$$\n\\text{Cov}(X, Y) = \\frac{1}{n-1} \\sum_{t=1}^{n} (X_t - \\bar{X})(Y_t - \\bar{Y})\n$$\n\nwhere $\\bar{X}$ and $\\bar{Y}$ are the sample means. A positive covariance indicates that when $X_t$ is above its mean, $Y_t$ tends to be above its mean as well, and vice versa.\n\n### Correlation\n\nCorrelation standardizes covariance, providing a dimensionless measure between -1 and 1:\n\n$$\n\\rho_{XY} = \\frac{\\text{Cov}(X, Y)}{\\sigma_X \\sigma_Y}\n$$\n\nwhere $\\sigma_X$ and $\\sigma_Y$ are the standard deviations of $X_t$ and $Y_t$. A correlation of 1 means perfect positive linear relationship, -1 means perfect negative linear relationship, and 0 suggests no linear relationship.\n\n### Partial Correlation\n\nPartial correlation measures the relationship between two variables while controlling for the effect of one or more additional variables. For three variables $X$, $Y$, and $Z$, the partial correlation between $X$ and $Y$ controlling for $Z$ is defined as:\n\n$$\n\\rho_{XY \\cdot Z} = \\frac{\\rho_{XY} - \\rho_{XZ}\\rho_{YZ}}{\\sqrt{(1-\\rho_{XZ}^2)(1-\\rho_{YZ}^2)}}\n$$\n\nThis formula removes the influence of $Z$ on both $X$ and $Y$, providing a clearer picture of their direct relationship.\n\n\n\n## Applied Example Using `fpp3` Data\n\nConsider the `global_economy` dataset from the `fpp3` package, which contains economic indicators for various countries over time. We can explore relationships such as:\n\n- Covariance and correlation between Growth and CPI for different countries.\n- Partial correlation to understand the relationship between Imports and Exports while controlling for GDP.\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Country                   |Code | Year|          GDP|    Growth|       CPI|  Imports|  Exports| Population|\n|:-------------------------|:----|----:|------------:|---------:|---------:|--------:|--------:|----------:|\n|Malaysia                  |MYS  | 2012| 3.144431e+11| 5.4734542| 104.89085| 68.54184| 79.29991|   29170456|\n|Kazakhstan                |KAZ  | 1965|           NA|        NA|        NA|       NA|       NA|   11588870|\n|Gibraltar                 |GIB  | 1980|           NA|        NA|        NA|       NA|       NA|      30272|\n|Romania                   |ROU  | 2003| 5.986780e+10| 5.5242778|  60.75242| 41.96958| 34.54293|   21574326|\n|Late-demographic dividend |LTE  | 1990| 2.033210e+12| 0.2089664|        NA| 17.18236| 18.22702| 1851248918|\n|Fiji                      |FJI  | 2011| 3.774531e+09| 2.7051430| 107.28240| 65.19624| 62.84121|     867086|\n|Vietnam                   |VNM  | 1997| 2.684370e+10| 8.1520841|  43.84315| 51.24178| 43.10271|   77453335|\n|Cameroon                  |CMR  | 2011| 2.933701e+10| 4.1292772| 102.93970| 31.00423| 25.93207|   20520447|\n|Poland                    |POL  | 2017| 5.264658e+11| 4.8057458| 109.63767| 50.26800| 54.29011|   37975841|\n|IDA blend                 |IDB  | 1965| 1.748448e+10| 5.6159946|        NA|       NA|       NA|  139283107|\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter data for Australia and select relevant variables\naus_data <- global_economy %>%\n  filter(Country == \"Australia\") %>%    # <1>\n  select(Year, GDP, Growth, Population, CPI, Imports, Exports) # <2>\n```\n:::\n\n1. Filter the `global_economy` dataset to include only rows where the country is Australia.\n2. Select the variables of interest: Year, Growth, Population, and CPI\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate covariance between GDP and Population for Australia\ncov_gdp_pop <- cov(aus_data$Growth, aus_data$CPI, use = \"complete.obs\")  # <1>\ncov_gdp_pop  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -17.36472\n```\n\n\n:::\n:::\n\n1. Compute the covariance between Growth and CPI for the Australian subset, using complete observations.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate correlation between GDP and Population for Australia\ncor_gdp_pop <- cor(aus_data$Growth, aus_data$CPI, use = \"complete.obs\")  # <1>\ncor_gdp_pop  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.2779003\n```\n\n\n:::\n:::\n\n1. Compute the Pearson correlation coefficient between GDP and Population.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute correlation matrix for GDP, Population, and Life Expectancy\ncor_matrix <- aus_data %>%\n  select(GDP, Growth, Population, CPI, Imports, Exports) %>%  # <1>\n  cor(use = \"complete.obs\")             # <2>\ncor_matrix  # <11>\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  GDP     Growth Population        CPI    Imports    Exports\nGDP         1.0000000 -0.2494090  0.9073355  0.9003771  0.7831384  0.8128970\nGrowth     -0.2494090  1.0000000 -0.2950084 -0.2779003 -0.1753012 -0.2251961\nPopulation  0.9073355 -0.2950084  1.0000000  0.9899235  0.9054921  0.9114850\nCPI         0.9003771 -0.2779003  0.9899235  1.0000000  0.9313180  0.9275880\nImports     0.7831384 -0.1753012  0.9054921  0.9313180  1.0000000  0.9238266\nExports     0.8128970 -0.2251961  0.9114850  0.9275880  0.9238266  1.0000000\nYear        0.8801466 -0.2863494  0.9966214  0.9906993  0.9224200  0.9195759\n                 Year\nGDP         0.8801466\nGrowth     -0.2863494\nPopulation  0.9966214\nCPI         0.9906993\nImports     0.9224200\nExports     0.9195759\nYear        1.0000000\n```\n\n\n:::\n:::\n\n1. Select columns for GDP, Growth, Population, CPI, Imports, and Exports from the Australian data.\n2. Calculate the correlation matrix for these variables using complete observations.\n\n- Partial correlation to understand the relationship between Imports and Exports while controlling for GDP.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Partial correlation between Imports and Exports controlling for GDP manually\n# Extract relevant correlation coefficients from the matrix\nrho_Imports_Exports <- cor_matrix[\"Imports\", \"Exports\"]         # <1>\nrho_Imports_GDP <- cor_matrix[\"Imports\", \"GDP\"]          # <2>\nrho_Exports_GDP <- cor_matrix[\"Exports\", \"GDP\"]  # <3>\n```\n:::\n\n1. Extracts the direct correlation between Imports and Exports.\n2. Extracts the correlation between Imports and GDP.\n3. Extracts the correlation between Exports and GDP.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute partial correlation between Imports and Exports controlling for GDP\npcorr_Imp_Exp_GDP <- (rho_Imports_Exports - rho_Imports_Exports * rho_Exports_GDP) /\n  sqrt((1 - rho_Imports_GDP^2) * (1 - rho_Exports_GDP^2))   # <1> \npcorr_Imp_Exp_GDP  # Display partial correlation result\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4772659\n```\n\n\n:::\n:::\n\n## Lab Activity: Recreate the above analysis using the class activity template and answer the following question:\n\n1. Apply the partial correlation formula to compute the relationship between GDP and Exports, controlling for Population.\n\n::: {.cell}\n```{webr}\n#| label: Activity2Lab1\naus_data <- global_economy %>%\n  filter(Country == \"Australia\") %>%    \n  select(Year, GDP, Growth, Population, CPI, Imports, Exports)\n\ncor_matrix <- aus_data %>%\n  select(GDP, Growth, Population, CPI, Imports, Exports) %>%  \n  cor(use = \"complete.obs\")             \n\n# Extract required correlations from the matrix\nrho_GDP_Exports <- cor_matrix[\"GDP\", \"Exports\"]  # r_xy\nrho_GDP_Pop <- cor_matrix[\"GDP\", \"Population\"]   # r_xz\nrho_Exports_Pop <- cor_matrix[\"Exports\", \"Population\"]  # r_yz\n\n# Apply partial correlation formula\npcorr_GDP_Exp_Pop <- (rho_GDP_Exports - rho_GDP_Pop * rho_Exports_Pop) / \n  sqrt((1 - rho_GDP_Pop^2) * (1 - rho_Exports_Pop^2))\n\npcorr_GDP_Exp_Pop  \n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
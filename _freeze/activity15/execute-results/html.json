{
  "hash": "33cbd9aacb7e415550116d9fdb64abc7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity15\"\nformat: live-html\nengine: knitr\ntoc: true\nwebr:\n  packages:\n    - dplyr\n    - ggplot2\n    - fpp3\n    - patchwork\n    - tsibbledata\n    - urca\n    - astsa\n    - COVID19\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n\n## Oil Prices Analysis: Brent, WTI & Impulse Response Function\n\n### Objective\n\nRetrieve Brent and WTI crude oil prices, compute daily returns, and explore a basic VAR model.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get Brent (BZ=F) and WTI (CL=F) crude oil prices and convert to tsibble\nbrent <- tq_get(\"BZ=F\", from = \"2021-01-01\", to = Sys.Date(), get = \"stock.prices\") %>% \n  as_tsibble(index = date)\n\nwti <- tq_get(\"CL=F\", from = \"2021-01-01\", to = Sys.Date(), get = \"stock.prices\") %>% \n  as_tsibble(index = date)\n\n# Merge Brent and WTI by date and compute daily returns\noil_data <- left_join(brent %>% select(date, adjusted) %>% rename(Brent = adjusted),\n                      wti %>% select(date, adjusted) %>% rename(WTI = adjusted),\n                      by = \"date\") %>% \n  mutate(dBrent = difference(Brent),\n         dWTI = difference(WTI)) %>% \n  drop_na() %>% \n  as_tsibble(index = date)\n\n# Plot daily returns for Brent and WTI\noil_data %>% \n  autoplot(vars(dBrent, dWTI)) +\n  labs(title = \"Daily Returns: Brent & WTI\", x = \"Date\", y = \"Return\")\n```\n\n::: {.cell-output-display}\n![](activity15_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### VAR Models & Impulse Response Functions\n\nA VAR (Vector Autoregression) model captures the dynamic relationships between multiple time series.\nIn our case, each variable (`dBrent` and `dWTI`) is modeled as a function of its own past values and those of the other.\n\nImpulse response functions (IRFs) trace the effect of a one-time shock to one variable (e.g., Brent returns)\non the future values of another variable (e.g., WTI returns). The IRF output typically displays point estimates and confidence intervals for the response over a series of future periods.\n\n\n### VAR Lag Order Selection\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to tibble for VAR analysis\noil_data_df <- oil_data %>% \n  as_tibble() %>%\n  select(dBrent, dWTI)\n\n# Select optimal lag order for the VAR model\nvar_selection <- VARselect(oil_data_df, lag.max = 20, type = \"const\")\nprint(var_selection$selection)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAIC(n)  HQ(n)  SC(n) FPE(n) \n    18      2      1     18 \n```\n\n\n:::\n:::\n\n\n### Fitting a VAR Model and Computing its IRF\n\nHere we fit a VAR model with a chosen lag order (e.g., p = 4) and compute its impulse response function.\n\n::: {.cell}\n\n```{.r .cell-code}\nvar_model_1 <- VAR(oil_data_df, p = 4, type = \"const\")\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute the IRF: show how a shock to Brent returns (dBrent) affects WTI returns (dWTI)\nirf_1 <- irf(var_model_1, impulse = \"dBrent\", response = \"dWTI\", boot = TRUE)\nplot(irf_1, main = \"IRF Demo: Shock to Brent Returns and Response of WTI Returns\")\n```\n\n::: {.cell-output-display}\n![](activity15_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nIn the IRF plot, we see:\n\n- The horizontal axis representing the number of periods after the shock.\n- The vertical axis showing the estimated change in WTI returns due to a unit shock in Brent returns.\n- A solid line for the point estimates and dashed lines indicating the confidence intervals.\n\nThis output helps visualize both the magnitude and duration of the shock's impact.\n\n### Lab Activity\n\n**Task:** Using the `oil_data_df`, fit VAR models with different lag orders (e.g., VAR(2) and VAR(3)) and analyze the impulse response functions (IRFs) to study how shocks in Brent returns affect WTI returns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# VAR model with lag order 2\nvar_model_2 <- VAR(oil_data_df, p = 2, type = \"const\")\nirf_2 <- irf(var_model_2, impulse = \"dBrent\", response = \"dWTI\", boot = TRUE)\nplot(irf_2, main = \"IRF: VAR(2) Model (Brent -> WTI)\")\n```\n\n::: {.cell-output-display}\n![](activity15_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# VAR model with lag order 3\nvar_model_3 <- VAR(oil_data_df, p = 3, type = \"const\")\nirf_3 <- irf(var_model_3, impulse = \"dBrent\", response = \"dWTI\", boot = TRUE)\nplot(irf_3, main = \"IRF: VAR(3) Model (Brent -> WTI)\")\n```\n\n::: {.cell-output-display}\n![](activity15_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n",
    "supporting": [
      "activity15_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}